"use strict";angular.module("tipExpert.user",["ngCookies"]),angular.module("tipExpert.match",[]),angular.module("tipExpert.game",[]),angular.module("tipExpert.home",[]);var tipExpert=angular.module("tipExpert",["tipExpert.home","tipExpert.user","tipExpert.match","tipExpert.game","ui.bootstrap","ui.router","pascalprecht.translate","ngCookies"]);tipExpert.config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(e,r,t,a){var o=userConfig.accessLevels,n={header:{templateUrl:"/js/home/views/header.html",controller:"navigationController"},main:{template:"<ui-view/>"},footer:{templateUrl:"/js/home/views/footer.html",controller:"languageController"}};e.state("user",{url:"/user",views:n,"abstract":!0}).state("user.overview",{title:"Users",url:"",templateUrl:"/js/user/views/user.html",controller:"userController",access:o.user}).state("user.profile",{title:"User profile",url:"/:userId",templateUrl:"/js/user/views/profile.html",controller:"userProfileController",access:o.user}).state("matches",{url:"/matches",views:n,"abstract":!0}).state("matches.overview",{title:"Matches",url:"",templateUrl:"/js/match/views/matches.html",controller:"matchController",access:o.admin}).state("matches.finished",{title:"Not implemented yet!",url:"/finished",templateUrl:"todo",controller:"finishedMatchesController",access:o.admin}).state("games",{url:"/games",views:n,"abstract":!0}).state("games.overview",{title:"Games",url:"",templateUrl:"/js/game/views/myGames.html",controller:"myGamesController",access:o.user}).state("games.history",{title:"Games History",url:"/history",templateUrl:"/js/game/views/gamesHistory.html",controller:"gamesHistoryController",access:o.user}).state("games.create",{title:"Create game",url:"/create",templateUrl:"/js/game/views/editGame.html",controller:"editGameController",access:o.user}).state("games.edit",{title:"Edit game",url:"/:gameId/edit",templateUrl:"/js/game/views/editGame.html",controller:"editGameController",access:o.user}).state("games.show",{title:"Game",url:"/:gameId",templateUrl:"/js/game/views/game.html",controller:"gameController",access:o.user}).state("home",{title:"Home",url:"/",views:{header:{templateUrl:"/js/home/views/landingPageHeader.html",controller:"navigationController"},main:{templateUrl:"/js/home/views/landingPage.html",controller:"homeController"},footer:{templateUrl:"/js/home/views/footer.html",controller:"languageController"}},access:o["public"]}),r.otherwise("/"),t.html5Mode({enabled:!0,requireBase:!1}),a.interceptors.push(["$q","$location",function(e,r){return{responseError:function(t){return 401===t.status||403===t.status?(r.path("/"),e.reject(t)):e.reject(t)}}}])}]),tipExpert.config(["$translateProvider",function(e){e.fallbackLanguage("en").registerAvailableLanguageKeys(["en","de"],{en_US:"en",en_UK:"en",de_DE:"de",de_CH:"de",de_AT:"de"}),e.useCookieStorage(),e.determinePreferredLanguage();var r=window.location.origin||window.location.protocol+"//"+window.location.host;e.useStaticFilesLoader({prefix:r+"/locales/",suffix:".json"})}]),tipExpert.run(["$rootScope","$location","$state","authService","alertService",function(e,r,t,a,o){e.$state=t,e.$on("$stateChangeStart",function(e,r,n,s,i){var l=a.user.isLoggedIn;a.authorize(r.access)?"home"==r.name&&l&&(e.preventDefault(),t.go("games.overview")):(e.preventDefault(),l?(s.controller||t.go("games.overview"),o.error("You are not allowed to access this page")):t.go("home"))})}]),function(e){e.roles={admin:1,user:2,"public":3},e.accessLevels={admin:1,user:2,"public":3}}("undefined"==typeof exports?this.userConfig={}:exports);var game=angular.module("tipExpert.game");game.controller("addGameController",["$scope","$modalInstance","$state","gameService","alertService",function(e,r,t,a,o){e.game={},e.save=function(){e.submitted=!0,this.addGameForm.$invalid||a.create(e.game).success(function(e){r.close(),t.go("games.edit",{gameId:e.id})}).error(o.error)},e.cancel=function(){r.dismiss("cancel")}}]);var game=angular.module("tipExpert.game");game.controller("editGameController",["$scope","$state","$stateParams","$modal","gameService","alertService",function(e,r,t,a,o,n){e.game={},t.gameId&&o.loadForEdit(t.gameId).success(function(r){e.game=r}).error(n.error),e.save=function(){e.submitted=!0,e.submitForm.$invalid||o.updateGameData(e.game).success(function(r){e.game=r,n.info("Successfully saved!")}).error(n.error)},e["delete"]=function(){return e.game.isFinished?void n.error("Can not delete a finished game!"):void o["delete"](e.game.id).success(function(){n.info("Successfully deleted!"),r.go("games.overview")}).error(n.error)},e.addMatch=function(){var r=a.open({templateUrl:"/js/game/views/selectMatchesDialog.html",controller:"selectMatchesController",resolve:{game:function(){return e.game}}});r.result.then(function(r){e.game=r,n.info("Changes successfully saved!")},function(){})},e.addPlayer=function(){var r=a.open({templateUrl:"/js/game/views/selectPlayersDialog.html",controller:"selectPlayersController",resolve:{game:function(){return e.game}}});r.result.then(function(r){e.game=r,n.info("Changes successfully saved!")},function(){})}}]);var game=angular.module("tipExpert.game");game.controller("gameController",["$scope","$modal","$stateParams","gameService","alertService",function(e,r,t,a,o){e.game={},e.submitted=!0,e.editStake=!1,e.cancelEditStake=function(){e.stake=e.game.player.stake,e.editStake=!1},e.saveStake=function(){a.updateStake(e.game.id,e.game.player.stake).success(function(r){e.game=r,e.editStake=!1}).error(o.error)},e.saveTip=function(r){a.updateTip(e.game.id,r).success(function(t){e.game=t,r.showSaveButton=!1,r.tipOfPlayer.oldHomeScore=r.tipOfPlayer.homeScore,r.tipOfPlayer.oldGuestScore=r.tipOfPlayer.guestScore}).error(o.error)},e.cancelTipEditing=function(e){e.showSaveButton=!1,e.tipOfPlayer.homeScore=e.tipOfPlayer.oldHomeScore,e.tipOfPlayer.guestScore=e.tipOfPlayer.oldGuestScore},t.gameId&&a.load(t.gameId).success(function(r){e.game=r}).error(o.error)}]);var game=angular.module("tipExpert.game");game.controller("gamesHistoryController",["$scope","$modal","gameService","alertService",function(e,r,t,a){e.games=[],t.loadFinishedGamesForCurrentUser().success(function(r){e.games=r}).error(a.error)}]);var game=angular.module("tipExpert.game");game.controller("myGamesController",["$scope","$modal","gameService","alertService",function(e,r,t,a){e.createdGames=[],e.invitedGames=[],e.createGame=function(){r.open({templateUrl:"/js/game/views/addGameDialog.html",controller:"addGameController"})},t.loadGamesCreatedByCurrentUser().success(function(r){e.createdGames=r}).error(a.error),t.loadGamesForCurrentUser().success(function(r){e.invitedGames=r}).error(a.error)}]);var game=angular.module("tipExpert.game");game.controller("selectMatchesController",["$scope","$modalInstance","leagueService","matchService","gameService","alertService","game",function(e,r,t,a,o,n,s){var i=s.matches.slice(0);e.loadMatches=function(r){a.loadForSelection(r).success(function(r){e.matches=r,angular.forEach(r,function(e){angular.forEach(i,function(r){e.id===r.matchId&&(e.selected=!0)})})}).error(n.error)},e.toggleMatchSelection=function(e){e.selected=!e.selected,e.selected?i.push({matchId:e.id}):angular.forEach(i,function(r){if(e.id===r.matchId){var t=i.indexOf(r);i.splice(t,1)}})},e.save=function(){o.updateMatches(s.id,i).success(function(e){r.close(e)}).error(n.error)},e.cancel=function(){r.dismiss("cancel")},t.load().success(function(r){e.leagues=r,r.length>0&&(e.league=r[0],e.loadMatches(e.league))}).error(n.error)}]);var game=angular.module("tipExpert.game");game.controller("selectPlayersController",["$scope","$modalInstance","authService","userService","gameService","alertService","game",function(e,r,t,a,o,n,s){var i=s.players.slice(0);e.toggleUserSelection=function(e){(null==t.user||e.userId!==t.user.id)&&(e.selected=!e.selected,e.selected?i.push(e):angular.forEach(i,function(r){if(e.userId===r.userId){var t=i.indexOf(r);i.splice(t,1)}}))},e.save=function(){o.updatePlayers(s.id,i).success(function(e){r.close(e)}).error(n.error)},e.cancel=function(){r.dismiss("cancel")},a.loadFriendsForUser(t.currentUser).success(function(r){e.users=r,angular.forEach(r,function(e){angular.forEach(i,function(r){e.userId===r.userId&&(e.selected=!0)})})}).error(n.error)}]);var game=angular.module("tipExpert.game");game.factory("gameService",["$http","$q",function(e,r){return{loadGamesForCurrentUser:function(){return e.get("/api/games/invited")},loadGamesCreatedByCurrentUser:function(){return e.get("/api/games/created")},loadFinishedGamesForCurrentUser:function(){return e.get("/api/games/finished")},load:function(r){return e.get("/api/games/"+r)},loadForEdit:function(r){return e.get("/api/games/"+r+"/edit")},create:function(r){return e.post("/api/games",r)},updateGameData:function(r){var t={id:r.id,title:r.title,description:r.description,minStake:r.minStake};return e.put("/api/games/"+r.id+"/edit/data",t)},updatePlayers:function(r,t){return e.put("/api/games/"+r+"/edit/players",t)},updateMatches:function(r,t){return e.put("/api/games/"+r+"/edit/matches",t)},updateStake:function(r,t){return e.put("/api/games/"+r+"/stake",t)},updateTip:function(r,t){return e.put("/api/games/"+r+"/tip",t)},"delete":function(r){return e["delete"]("/api/games/"+r+"/edit")}}}]);var homeModule=angular.module("tipExpert.home");homeModule.controller("homeController",["$scope","$state","$window","$modal","authService","alertService",function(e,r,t,a,o,n){e.user={name:"",email:"",password:""},e.openLogin=function(){a.open({templateUrl:"/js/home/views/loginDialog.html",controller:"loginController"})},e.openSignup=function(){a.open({templateUrl:"/js/home/views/signUpDialog.html",controller:"signUpController"})},e.loginOauth=function(e){t.location.href="/auth/"+e}}]);var user=angular.module("tipExpert.user");user.controller("languageController",["$scope","$translate",function(e,r){e.changeLanguage=function(e){r.use(e)}}]);var homeModule=angular.module("tipExpert.home");homeModule.controller("loginController",["$scope","$state","$modalInstance","authService","alertService",function(e,r,t,a,o){e.user={name:"",email:"",password:""},e.login=function(){e.submitted=!0,e.loginForm.$invalid||a.login(e.user).then(function(){e.cancel(),r.go("games.overview")})["catch"](o.error)},e.cancel=function(){t.dismiss("cancel")}}]);var user=angular.module("tipExpert.user");user.controller("navigationController",["$scope","$state","authService","alertService",function(e,r,t,a){e.user=t.user,e.logout=function(){t.logout().then(function(){r.go("home")})["catch"](a.error)},e.loginOauth=function(e){$window.location.href="/auth/"+e},e.alerts=a.alerts,e.closeAlert=function(e){a.closeAlert(e)}}]);var homeModule=angular.module("tipExpert.home");homeModule.controller("signUpController",["$scope","$state","$modalInstance","authService","alertService",function(e,r,t,a,o){e.user={name:"",email:"",password:""},e.signup=function(){e.submitted=!0,e.signUpForm.$invalid||a.signup(e.user).then(function(){e.cancel(),r.go("games.overview")})["catch"](o.error)},e.cancel=function(){t.dismiss("cancel")}}]);var user=angular.module("tipExpert.user");user.factory("alertService",["$timeout",function(e){var r=[],t=function(t,o){var n="An error occoured";void 0!=t&&(n=void 0!=t.msg?t.msg:void 0!=t.errors?t.errors[0]:t);var s={msg:n,type:o};s.timeout=e(function(){a(s)},5e3),r.push(s)},a=function(t){t.timeout&&e.cancel(t.timeout);var a=r.indexOf(t);r.splice(a,1)};return{alerts:r,error:function(e){t(e,"warning")},info:function(e){t(e,"success")},closeAlert:function(e){a(r[e])}}}]);var matchModule=angular.module("tipExpert.match");matchModule.factory("leagueService",["$http",function(e){return{load:function(){return e.get("/api/leagues")},create:function(r){return e.post("api/leagues/",r)},update:function(r){return e.put("/api/leagues/"+r.id,r)},"delete":function(r){return e["delete"]("api/leagues/"+r.id)}}}]);var matchModule=angular.module("tipExpert.match");matchModule.factory("matchService",["$http",function(e){return{load:function(r){return e.get("/api/leagues/"+r.id+"/matches")},loadForSelection:function(r){return e.get("/api/leagues/"+r.id+"/matches/notfinished")},create:function(r){return e.post("api/matches/",r)},update:function(r){return e.put("/api/matches/"+r.id,r)},"delete":function(r){return e["delete"]("api/matches/"+r.id)}}}]);var match=angular.module("tipExpert.match");match.controller("editMatchController",["$scope","$modalInstance","matchService","alertService","match",function(e,r,t,a,o){e.match=o,e.save=function(){var e=o.id?t.update(o):t.create(o);e.success(function(e){r.close(e)}).error(a.error)},e.cancel=function(){r.dismiss("cancel")}}]);var match=angular.module("tipExpert.match");match.controller("matchController",["$scope","$modal","leagueService","matchService","alertService",function(e,r,t,a,o){e.selectedMatch={homeTeam:"",guestTeam:"",dueDate:new Date},e.leagues=[],e.newLeague={name:""};var n=function(){t.load().success(function(r){e.leagues=r,angular.forEach(e.leagues,function(e){e.editorEnabled=!1}),e.leagues.length>0&&e.loadMatches(e.leagues[0])}).error(o.error)};e.addLeague=function(){t.create(e.newLeague).success(function(r){r.editorEnabled=!1,e.leagues.push(r),e.newLeague=""}).error(o.error)},e.removeLeague=function(e){t["delete"](e).success(n).error(o.error)},e.editLeague=function(e){e.editorEnabled=!0,e.editableName=e.name},e.cancelEditLeague=function(e){e.editorEnabled=!1},e.saveLeague=function(e){e.name=e.editableName,t.update(e).success(function(r){e.editorEnabled=!1}).error(o.error)},e.loadMatches=function(r){e.selectedLeague=r,a.load(r).success(function(r){e.matches=r}).error(o.error)},e.addMatch=function(){var r={homeTeam:"",guestTeam:"",dueDate:Date.now(),leagueId:e.selectedLeague.id};e.editMatch(r)},e.editMatch=function(t){var a=r.open({templateUrl:"/js/match/views/editMatchDialog.html",controller:"editMatchController",resolve:{match:function(){return t}}});a.result.then(function(r){e.loadMatches(e.selectedLeague)},function(){})},n()}]);var user=angular.module("tipExpert.user");user.controller("userController",["$scope","userService","alertService",function(e,r,t){e.roles=[{name:"Admin",index:1},{name:"User",index:2}],e.save=function(){r.update(e.users).then(function(){t.info("Successfully saved.")})["catch"](t.error)},r.loadAllUser().success(function(r){e.users=r}).error(t.error)}]);var user=angular.module("tipExpert.user");user.controller("userProfileController",["$scope","$stateParams","userService","alertService",function(e,r,t,a){e.user={},e.hideRole=!0,r.userId&&t.loadProfile(r.userId).success(function(r){e.user=r,e.hideRole=r.role==userConfig.roles.user}).error(a.error)}]);var userModule=angular.module("tipExpert.user");userModule.factory("authService",["$http","$q","$cookieStore","userService",function(e,r,t,a){var o=userConfig.accessLevels,n=userConfig.roles,s=t.get("user")||{id:"",name:"",role:n["public"],email:""};s.isLoggedIn=s.role==n.user||s.role==n.admin;var i=function(e){t.remove("user"),s.id=e.id,s.name=e.name,s.role=e.role,s.email=e.email,s.picture=e.picture,s.coins=e.coins,s.isLoggedIn=e.role==n.user||e.role==n.admin,s.isAdmin=e.role==n.admin,t.put("user",s)};return{authorize:function(e){var r=s.role;return e==o.admin?r==n.admin:e==o.user?r==n.admin||r==n.user:!0},signup:function(t){var a=r.defer();return e.post("/api/account/signup",t).success(function(e){i(e),a.resolve(e)}).error(a.reject),a.promise},login:function(t){var a=r.defer();return e.post("/api/account/login",t).success(function(e){i(e),a.resolve(e)}).error(a.reject),a.promise},logout:function(){var t=r.defer();return e.post("api/account/logout").success(function(){i({username:"",role:n["public"]}),t.resolve()}).error(t.reject),t.promise},user:s}}]);var user=angular.module("tipExpert.user");user.factory("userService",["$http","$q",function(e,r){return{loadAllUser:function(){return e.get("/api/account")},loadFriendsForUser:function(r){return e.get("/api/account/friends")},loadProfile:function(r){return e.get("/api/account/"+r)},update:function(t){var a=r.defer(),o=[];return angular.forEach(t,function(r){o.push(e.put("/api/account/"+r.id,r))}),r.all(o).then(a.resolve)["catch"](function(e){a.reject(e.data)}),a.promise}}}]);